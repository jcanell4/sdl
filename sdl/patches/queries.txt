//S'afegeix un nou camp per controlar s'ha fet un càlcul aproximat de la data d'edició o per contra, es tracta d'una dada fiable;
CREATE TABLE CALCDATEMAP (ID varchar(3) PRIMARY KEY, DESC varchar(20));
@MANDATORY_START;
INSERT INTO CALCDATEMAP VALUES('SCL', 'sense classificar');
INSERT INTO CALCDATEMAP VALUES('FIA', 'fiable');
INSERT INTO CALCDATEMAP VALUES('APR', 'aproximada');
INSERT INTO CALCDATEMAP VALUES('ILL', 'illegible');
@MANDATORY_END;
ALTER TABLE RESOURCE ADD CALCDATE_ID varchar(3) default 'SCL';
ALTER TABLE RESOURCE ADD FOREIGN KEY (CALCDATE_ID) REFERENCES CALCDATEMAP(ID);
ALTER TABLE SEARCHRESOURCE ADD SEARCHDATE varchar(15);
UPDATE SEARCHRESOURCE SET SEARCHRESOURCE.SEARCHDATE=(SELECT RESOURCE.SEARCHDATE from RESOURCE WHERE SEARCHRESOURCE.RESOURCEID=RESOURCE.ID) WHERE EXISTS (SELECT RESOURCE.SEARCHDATE FROM RESOURCE WHERE SEARCHRESOURCE.RESOURCEID=RESOURCE.ID);
ALTER TABLE RESOURCE DROP COLUMN SEARCHDATE;
RUN PACHCODE CLASS: org.elsquatrecaps.jig.sdl.persistence.patcher.RenameFilesForVersion2023;
ALTER TABLE RESOURCE ADD DOCID varchar(30); 
ALTER TABLE RESOURCE ADD PAGEID varchar(30); 
UPDATE RESOURCE as r SET DOCID=ID, PAGEID='';
CREATE TABLE RF_TMP AS SELECT * FROM RESOURCE_FORMAT;
DROP TABLE RESOURCE_FORMAT;
CREATE TABLE RESOURCE_FORMAT (RESOURCE_ID VARCHAR(255) NOT NULL, RESOURCEFORMATS_ORDER INTEGER NOT NULL, FORMAT varchar(5), CONSTRAINT "RF_PK" PRIMARY KEY (RESOURCE_ID, RESOURCEFORMATS_ORDER), CONSTRAINT "RF_R_FK" FOREIGN KEY (RESOURCE_ID) REFERENCES RESOURCE(ID));
MERGE INTO RESOURCE_FORMAT AS RF USING RF_TMP ON (RF.RESOURCE_ID=RF_TMP.RESOURCE_ID AND RF.RESOURCEFORMATS_ORDER=RF_TMP.SUPPORTEDFORMATS_ORDER) WHEN NOT MATCHED THEN INSERT(RESOURCE_ID, RESOURCEFORMATS_ORDER, FORMAT) VALUES(RF_TMP.RESOURCE_ID, RF_TMP.SUPPORTEDFORMATS_ORDER, RF_TMP.SUPPORTEDFORMATS);
DROP TABLE RF_TMP;
ALTER TABLE RESOURCE_FORMAT ADD CONTENTTYPE varchar(1); 
UPDATE RESOURCE_FORMAT SET CONTENTTYPE='D';
ALTER TABLE RESOURCE DROP COLUMN FILENAME;
ALTER TABLE RESOURCE ALTER COLUMN DOCID varchar(64); 
ALTER TABLE RESOURCE ALTER COLUMN PAGEID varchar(32); 
ALTER TABLE RESOURCE_FRAGMENT ALTER COLUMN FRAGMENTS varchar(500); 